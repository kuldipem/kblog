(function(b){b.fn.gMap=function(a,f){switch(a){case"addMarker":return b(this).trigger("gMap.addMarker",[f.latitude,f.longitude,f.content,f.icon,f.popup]);case"centerAt":return b(this).trigger("gMap.centerAt",[f.latitude,f.longitude,f.zoom])}var e=b.extend({},b.fn.gMap.defaults,a);return this.each(function(){var d=new google.maps.Map(this),o=new google.maps.Geocoder;e.address?o.geocode({address:e.address},function(g,h){g&&g.length&&d.setCenter(g[0].geometry.location)}):e.latitude&&e.longitude?d.setCenter(new google.maps.LatLng(e.latitude,e.longitude)):b.isArray(e.markers)&&e.markers.length>0?e.markers[0].address?o.geocode({address:e.markers[0].address},function(g,h){g&&g.length>0&&d.setCenter(g[0].geometry.location)}):d.setCenter(new google.maps.LatLng(e.markers[0].latitude,e.markers[0].longitude)):d.setCenter(new google.maps.LatLng(34.885931,9.84375)),d.setZoom(e.zoom),d.setMapTypeId(google.maps.MapTypeId[e.maptype]);var n={scrollwheel:e.scrollwheel,disableDoubleClickZoom:!e.doubleclickzoom};e.controls===!1?b.extend(n,{disableDefaultUI:!0}):e.controls.length!=0&&b.extend(n,e.controls,{disableDefaultUI:!0}),d.setOptions(n);var m=new google.maps.Marker;marker_icon=new google.maps.MarkerImage(e.icon.image),marker_icon.size=new google.maps.Size(e.icon.iconsize[0],e.icon.iconsize[1]),marker_icon.anchor=new google.maps.Point(e.icon.iconanchor[0],e.icon.iconanchor[1]),m.setIcon(marker_icon),e.icon.shadow&&(marker_shadow=new google.maps.MarkerImage(e.icon.shadow),marker_shadow.size=new google.maps.Size(e.icon.shadowsize[0],e.icon.shadowsize[1]),marker_shadow.anchor=new google.maps.Point(e.icon.shadowanchor[0],e.icon.shadowanchor[1]),m.setShadow(marker_shadow)),b(this).bind("gMap.centerAt",function(g,p,i,h){h&&d.setZoom(h),d.panTo(new google.maps.LatLng(parseFloat(p),parseFloat(i)))});var l;b(this).bind("gMap.addMarker",function(w,v,u,t,s,r){var q=new google.maps.LatLng(parseFloat(v),parseFloat(u)),p=new google.maps.Marker({position:q});s?(marker_icon=new google.maps.MarkerImage(s.image),marker_icon.size=new google.maps.Size(s.iconsize[0],s.iconsize[1]),marker_icon.anchor=new google.maps.Point(s.iconanchor[0],s.iconanchor[1]),p.setIcon(marker_icon),s.shadow&&(marker_shadow=new google.maps.MarkerImage(s.shadow),marker_shadow.size=new google.maps.Size(s.shadowsize[0],s.shadowsize[1]),marker_shadow.anchor=new google.maps.Point(s.shadowanchor[0],s.shadowanchor[1]),m.setShadow(marker_shadow))):(p.setIcon(m.getIcon()),p.setShadow(m.getShadow()));if(t){t=="_latlng"&&(t=v+", "+u);var g=new google.maps.InfoWindow({content:e.html_prepend+t+e.html_append});google.maps.event.addListener(p,"click",function(){l&&l.close(),g.open(d,p),l=g}),r&&google.maps.event.addListenerOnce(d,"tilesloaded",function(){g.open(d,p)})}p.setMap(d)});for(var k=0;k<e.markers.length;k++){marker=e.markers[k];if(marker.address){marker.html=="_address"&&(marker.html=marker.address);var j=this;o.geocode({address:marker.address},function(g,h){return function(i,c){i&&i.length>0&&b(h).trigger("gMap.addMarker",[i[0].geometry.location.lat(),i[0].geometry.location.lng(),g.html,g.icon,g.popup])}}(marker,j))}else{b(this).trigger("gMap.addMarker",[marker.latitude,marker.longitude,marker.html,marker.icon,marker.popup])}}})},b.fn.gMap.defaults={address:"",latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:!1,doubleclickzoom:!0,maptype:"ROADMAP",html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}})(jQuery);